(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const o=flarum.core.compat["common/extend"],n=flarum.core.compat["common/app"];var i=t.n(n);function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}const a=flarum.core.compat["common/components/Button"];var c=t.n(a);const s=flarum.core.compat["common/components/Tooltip"];var d=t.n(s),l=function(t){var e,o;function n(){return t.apply(this,arguments)||this}return o=t,(e=n).prototype=Object.create(o.prototype),e.prototype.constructor=e,r(e,o),n.prototype.view=function(e){var o=t.prototype.view.call(this,e),n=this.attrs.tooltipText||o.attrs.title;return delete o.attrs.title,m(d(),{showOnFocus:!1,text:n},o)},n.initAttrs=function(e){t.initAttrs.call(this,e),e.className="Button Button--icon Button--link Button-MyEmoji",e.tooltipText=e.title},n}(c());const u=flarum.core.compat["common/components/TextEditor"];var p=t.n(u);i().initializers.add("nodeloc-flarum-ext-my-emoji",(function(){(0,o.extend)(p().prototype,"oninit",(function(){this.isPickerLoaded=!1,this.MyEmojiContainer=null,this.$MyEmojiContainer=null})),(0,o.extend)(p().prototype,"toolbarItems",(function(t){var e=this;t.remove("emoji"),t.remove("mentions"),t.remove("emoji"),t.add("MyEmoji",l.component({onclick:function(t){t.preventDefault(),e.MyEmojiContainer||(e.createMyEmojiContainer(),e.loadMyEmojiData()),e.isPickerLoaded?(e.isPickerLoaded=!1,e.hideMyEmojiContainer(),m.redraw()):(e.showMyEmojiContainer(),e.isPickerLoaded=!0,m.redraw())},icon:"far fa-smile-wink",title:i().translator.trans("nodeloc-emoji.forum.composer.emoji_tooltip")}))})),(0,o.extend)(p().prototype,"onremove",(function(){this.MyEmojiContainer&&this.MyEmojiContainer.remove()})),(0,o.extend)(p().prototype,"createMyEmojiContainer",(function(){this.MyEmojiContainer=document.createElement("div"),this.MyEmojiContainer.classList.add("ComposerBody-MyEmojiContainer"),this.$MyEmojiContainer=$(this.MyEmojiContainer),document.body.appendChild(this.MyEmojiContainer)})),(0,o.extend)(p().prototype,"loadMyEmojiData",(function(){var t=this;i().request({method:"GET",url:i().forum.attribute("apiUrl")+"/nodeloc/myemoji"}).then((function(e){var o=i().forum.attribute("baseUrl"),n=[];e.data.forEach((function(t){var e,i,r=t.attributes.path;n.push({name:t.attributes.title,textToReplace:t.attributes.text_to_replace,emoji:(e=r,i=new RegExp("^(http|https)://","i"),e.match(i)?r:o+r),category:t.attributes.category,category_name:t.attributes.category_name})}));var r=n.reduce((function(t,e){return(t[e.category]=t[e.category]||[]).push(e),t}),{}),a=document.createElement("div");a.classList.add("emoji-picker__wrapper"),t.MyEmojiContainer.appendChild(a);var c=document.createElement("div");a.appendChild(c);var s=document.createElement("div");s.classList.add("emoji-picker"),s.style.maxHeight="300px",s.style.overflowY="auto",a.appendChild(s);var d=document.createElement("div");d.classList.add("MyEmoji-tab-bar"),c.appendChild(d),Object.keys(r).forEach((function(t,e){var o=document.createElement("button"),n=r[t][0].category_name;o.textContent=n,o.dataset.categoryId=t,0===e&&o.classList.add("active"),o.addEventListener("click",(function(){d.querySelectorAll("button").forEach((function(t){t.classList.remove("active")})),o.classList.add("active"),l(r[t])})),d.appendChild(o)}));var l=function(e){s.innerHTML="",e.forEach((function(e){var o=document.createElement("span");o.className="MyEmoji";var n=document.createElement("img");n.src=e.emoji,n.title=e.name,n.alt=e.name,n.style.cursor="pointer",n.addEventListener("click",(function(){t.attrs.composer.editor.insertAtCursor(e.textToReplace),t.isPickerLoaded=!1,t.hideMyEmojiContainer()})),o.appendChild(n),s.appendChild(o)}))},u=Object.keys(r)[0];l(r[u]);var p=document.querySelector(".Button-MyEmoji");if(p){var y=p.getBoundingClientRect(),f=window.innerWidth<=768,h=f?"50%":y.top-t.MyEmojiContainer.offsetHeight+"px",j=f?"50%":y.left+(y.width-t.MyEmojiContainer.offsetWidth)/2+"px";t.$MyEmojiContainer.css({position:"fixed",top:""+h,left:""+j,transform:f?"translate(-50%, -50%)":"",width:f?"90%":"",margin:f?"auto":""})}t.$MyEmojiContainer.on("mousedown",(function(t){t.stopPropagation()})),$(document).on("mousedown",(function(e){console.log("test",t.isPickerLoaded),!t.$MyEmojiContainer.is(e.target)&&t.isPickerLoaded&&(t.isPickerLoaded=!1,t.hideMyEmojiContainer(),m.redraw())}))}))})),(0,o.extend)(p().prototype,"showMyEmojiContainer",(function(){this.$MyEmojiContainer.css({visibility:"visible"})})),(0,o.extend)(p().prototype,"hideMyEmojiContainer",(function(){this.$MyEmojiContainer.css({visibility:"hidden"})}))}),-150)})(),module.exports=e})();
//# sourceMappingURL=forum.js.map